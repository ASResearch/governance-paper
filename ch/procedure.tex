\section{治理流程}
在NBRE中，升级通过提交IR来进行。不同IR的提交会对星云链整体系统环境的性能产生实质性的影响，IR的提交实际程度上决定了星云链主网的升级和性能推进方向。

现阶段星云链的功能特点并未全部实现，星云团队会慎重开放提交IR的权限。当前治理流程如下：

\textbf{治理流程（现阶段）}	
\begin{enumerate}
\item \textbf{提案阶段}（Proposal Period）：在社区公开讨论提案，发起项目，并可申请使用社区预留资金；
\item \textbf{投票阶段}（Proposal Voting Period）：投票区块期间，赞同票NR占比超过全网NR值一定比例x\%，视作通过；
\item \textbf{开发阶段}（Develop Period）：提案人进行开发，或在社区寻找开发者共同开发，开发过程在协作平台（go.nebulas.io）上公开；
\item \textbf{测试阶段}（Testing Period）：经主网团队操作，部署测试网公测，关于IR是否可以部署到主网进行链上加权投票，投票区块期间，赞同票NR占比超过全网NR值不小于x\%，视作通过；
\item \textbf{发布阶段}（NBRE Period）：经技术委员会验收核实，且测试期内没有争议，IR被NBRE执行，并入主网。
\end{enumerate}

\textbf{治理流程（NF实现后）}

NF实现后，任何人可以提交IR，以主网NF侧链形式存在，不需要经过主网团队审批即可自行测试。

\subsection{提案}
星云链技术开发和运营为项目制，项目的发起、立项、预决算、执行、审核由星云技术委员会负责组织。星云技术委员会只负责监督，保证整个流程公开透明。如涉及线下活动，应符合当地相关法律法规。原则上星云技术委员会不介入其中，并且不承担任何责任。

\textbf{提案人}

所有社区成员。

\textbf{提案方式}

在提案专区公开发出提案。

\textbf{提案内容}

一份完整的提案需要包括以下内容：
\begin{enumerate}
\item 提案人姓名（需要登录）
\item 提案描述（当前问题、解决方案、理由）
\item 提案成果形式（如github地址、DApp、PDF、文稿链接等，也可以是综合性结果或报告）
\item 指定执行人，无指定执行人则可以在社区公开招募执行人
\item 各时间点设定：投票开始和结束时间、招募执行人时间、执行阶段时间点和截止日期、执行耗时预估、测试时长
\item 如果申请使用社区预留资金，需要填写明确金额（NAS作为计价单位）
\end{enumerate}

\textbf{提案时长}

由提案人自由定义。

\textbf{提案修改}

在投票正式开始之前，提案人可以修改提案所有内容。其他人可以评论、关注等。每次修改需要支付$n^2$ NAS。这部分奖励会均分给当次提案前参与过讨论的用户。

\textbf{提案取消}

在正式投票开始之前，提案人可以取消提案。正式投票开始后，不可取消提案。

\subsection{投票}
\subsection{投票的基本原则}

星云链聚焦链上治理，致力于运用区块链技术来提供更公平的协作环境。星云链生态中的投票将通过星云主网实现，社区投出的每一票，将在星云链的区块上公开、透明的展现。

同时星云链期望构建自治元网络，希望借助网络中的元数据和元数据的超映射，处理复杂的数据和交互及协作关系。星云链的投票权重将参照星云自治元网络中的元数据及元数据的超映射。

在星云链的系统中，投票将遵循以下原则：
1. 投票的最基本单位是一个星云主网地址
2. 星云链的投票权重将参照地址的星云指数
3. 对系统有积极贡献的行为应被奖励更多的投票权，在投票的场景中，我们认为投票行为是对星云系统有积极贡献的行为，应被激励更多的投票权
4. 投票唯一的介质为星云指数的资产化表现，Nebulas Autonomous Token （NAT·星元币）

\subsubsection{投票方式}

投票将通过星云链主网上的投票智能合约实现，每个地址可以选择投赞同、反对、弃权三种票。亦可不参与投票。

\subsubsection{投票的唯一介质：Nebulas Autonomous Token （NAT·星元币）}

\textbf{名称}
 
星元币 Nebulas Autonomous Token

\textbf{代号}

NAT

\textbf{形式}

NRC20 token

\textbf{发行量}
	
NAT的发行量与星云链全网的星云指数（Nebulas Rank，NR）相关。在星云链全网星云指数恒定的情况下，NAT发行量恒定且释放的数量按周期递减，衰减系数为λ。

NAT的初始发行总量将参照星云链主网Nebulas NOVA上线时的全网星云指数，总发行量为【1000】亿枚，初始设定λ=【0.996】， 在λ和全网NR指数不变的情况下，NAT的释放量在第二年衰减为前一年的50\%。 \xpcomment{（待确认—）} 

\xpcomment{（关于NAT的具体的发行的递减参数请参见【5.3】NAT算法）} 

\textbf{发行方式}

NAT将通过空投和质押星云链主网原生代币NAS两种方式，针对且只针对星云主网的用户发行。

NAT的发行将分周期进行，定义每个发行周期为$i$，【且发行周期和投票周期一致】，NAT的发行将遵循如下原则：
1. 每个空投周期内单位地址获得的NAT和该地址的NR正相关，下一个周期空投的比例在前个周期的基础上进行衰减，衰减系数为$λ$
2. 地址在当前周期的投票行为会对当前周期空投的NAT数量有额外加成，加成系数为：$μ$
3. 用户质押星云主网的原生资产NAS达到6$α$个周期以上，可以获得NAT
4. 空投部分和质押部分不可同时获得


\textbf{空投部分}
在每个发行周期内，持有星云主网的地址，且在过去6个空投周期内的NR加权不为零的地址，可以获得NAT空投。

在单一的发行周期内将进行两次空投，
1. 在空投周期初始，空投比例将参照以下函数，使得空投的比例和用户地址的NR值成正比，且空投比例会随着时间进行衰减。在越靠前的周期内，同一地址获得的空投的比例越高。
\xpcomment{（插入A部分的函数）} 

2. 在空投周期结束前，按照用户在此周期内的投票行为进行第二次空投，此次空投将给予参与投票的用户额外的NAT加成。用户投出赞成、反对和弃权票均可获得加成。如此次空投周期中，用户未参与投票，则无法获得此部分加成。加成部分按照一下函数计算：
\xpcomment{（插入B部分的函数）} 

\textbf{质押部分}

用户向投票的智能合约质押NAS可以获得一定比例的NAT返还，用户将按照自己质押NAS占全网总质押NAS的比例瓜分质押部分的NAT，在每个发行周期内，质押部分返还的NAT将按照一下函数计算：
\xpcomment{（插入C部分的函数）} 

\textbf{NAT的烧毁}
在每个发行周期投入星云链投票智能合约的NAT将被烧毁，烧毁的比例会按照周期递减，递减速率和NAT发行的递减速率一致。在每个周期内，未被烧毁的NAT，将会在每个周期的第二次空投的过程中返还给本周期内参与投票的用户。每个周期内烧毁部分的NAT将按照一下函数计算：
\xpcomment{（插入NAT烧毁速率的函数）} 

\textbf{NAT的使用场景}

NAT将作为星云生态中投票场景的唯一介质，支持星云推进社区的治理。社区成员可以通过使用NAT投票表达自己自己对星云生态的意见，包括但不限于星云理事会的选举、星云主网NBRE中执行的IR及星云项目提案的立项表决等。

\textbf{管理}

用户可以在NAS Nano Pro及其他支持NRC20的钱包中管理自己的NAT。同时，用户可以在支持星云链的区块链浏览器上（比如explorer.nebulas.io）查看NAT的交易、流通情况等。

\textbf{星云指数作为投票权重的原因}

根据星云链的治理原则，链上治理的最基本单位是一个星云主网地址，星云生态的治理投票将通过链上投票的方式进行。链上投票所有的投票行为和交易信息均将在区块链上记录，公开、透明、不可篡改。

同时，星云链期望运用区块链技术构建一个面向复杂数据和交互的，可以促进社区良性发展的协作体系。在这个体系中，对于生态具有更多贡献的人应该在生态治理中享有更多的话语权，应该被激励更多的投票权。

基于此，一段时间内某个地址的NAT的持有量应该要反映一段时间内该地址持有者在生态中的贡献度。同时，NAT需要具备良好的抗作弊性，需要能够防止恶意的刷票行为。

根据NAT的发行方式，某个地址在一段时间内获得的NAT的数量将主要受两个因素影响：1）该地址的在一段期间内的核心星云指数，2）该地址的投票行为。

其中星云指数是星云链的独创技术，核心星云指数也是将在Nebulas NOVA中重要功能之一。
根据2018年6月30日星云研究院发布的《星云指数黄皮书》，星云指数用以衡量区块链世界链上数据价值，以流动性、传播性、互操作性等体现数据互动关系的因素为基础，可以用来衡量地址、智能合约、去中心化应用等对象的影响力。其中，核心星云指数
(Core Nebulas Rank)考虑资产中值和出入度衡量，在微观层面，核心星云指数衡量了每个账户对经济系统的贡献；在宏观层面，核心星云指数则用经济学中经典的货币数量方程描述了区块链中货币数量、货币价值和流通速率以及生产力几者之间的关系。
因此，我们将每个账户可以获得的NAT的数量和一段时间内每个账户的核心星云指数相关联，并将NAT在一段时间的总供应量和整个星云生态的核心星云指数相关联。一方面，从微观层面反映每个账户在一段时间内对经济体的贡献程度，另一方面使NAT的总供应量和整个经济体宏观层面的活跃程度相关。

除此之外，公平性是星云指数的重要特性之一。在《星云指数黄皮书》我们已经指出了PageRank类排名策略在应对“女巫攻击”时存在缺陷。在区块链系统上，女巫攻击表现为攻击者创建大量账号并且拆分资产分开进行交易获取更高收益。星云指数将主要通过以下两点来应对操作和作弊带来的挑战
1)	旨在通过防止用户借由控制多个账户实现某交易行为的收益大于通过单一账户实现该交易的收益
2)	星云指数中的二维出入度计算函数也鼓励账户之间的正常交易流通
因此，在星云链主网上的”女巫攻击“行为无法为攻击者带来更高的星云指数的收益，进而无法为攻击者带来超出其对经济体实际贡献的NAT，可以有效的抵抗恶意刷票。

同时，我们认为，在生态中积极参与投票的用户应该被激励。因此，系统将会按照一段投票期间内地址的投票行为给予额外比例的NAT。在前一个投票周期里没有参与投票的用户在下一个空投周期中仍可按照自己地址的NR比例获得一定数量的NAT，但是无法获得投票行为激励的部分。

基于此，NAT不仅可以反映单位地址对于星云生态的贡献度，并且具有抗作弊性，可以应对投票过程中由于恶意刷票产生的可能的舞弊行为。

我们认为在当前阶段，NAT是合适的投票介质。诚然，NAT在实际应用中仍会面临不同的挑战，我们也将根据NAT在投票场景中的实际情况及社区的意愿调整NAT的参数和算法。



\textbf{投票时长}

提案人自定义。但必须限定投票时长，不能无限投票。提案人可以向星云技术委员会咨询指导建议。

\textbf{投票管理}

公开投票由技术委员会负责组织和管理。公开投票接受所有人的公开监督。针对违反社区治理基本准则的提案，技术委员会可以向理事会发起重审提案申请。星云理事会作为星云社区治理的监管机构，有权对任何提案的投票发起二次投票。对于同一提案，理事会可以且仅可以发起一次二次投票。

\textbf{投票流程}
\begin{enumerate}

\item 用户投票

用户在提案平台可以查看，每个地址针对一个提案可以投X NAT，投出的NAT在系统中将全额烧毁。

\end{enumerate}

\textbf{投票结果}

满足以下条件算投票通过：

\begin{enumerate}
\item 赞同票总占比大于51\%
\item 投票期间，参与投票的NAT占比超过全网NAT值一定比例x\%，x\%的决定因素为提案申请的金额占链上流通量比例。{\color{red}（建议改成固定NAT数值，可动态调）}
\item 如果金额为0，x\%有保底值。
\end{enumerate}

\subsubsection{公开透明}
投票过程时刻保持公开透明，投票结果不可修改，星云理事会将监督投票流程的正当性。

\textbf{技术合法性}
\begin{enumerate}
\item 链上投票保证了投票过程的公正性和安全性。同时若引入匿名制还能有效保护成员隐私（隐藏其投票内容）。
\item NR的抗作弊性质保证了投票过程的公平性：成员建立大量新账户不会提高他的投票效用，同时高资产成员将其资产分散到多个子账户亦不会提升其投票总效用。
\item 投票所采用的各项技术是与Nebulas NOVA的技术一脉相承的，如DIP本质上实现的就是用户给DApp投票的过程。同时我们今后也会不断对投票技术进行补充和完善，将其作为一个不可分割的整体。
\end{enumerate}

\textbf{NAT的白名单和黑名单地址}
【涉及到交易所地址、DIP地址、DPos地址和理事会资金、三会质押资金的地址】，这部分的白名单黑名单操作及产生的NAT可以使用？
DIP的地址、三会管理/锁仓的地址的资金，作为白名单，享受投票行为部分的NAT激励，但是token不能投票(因为没有代表用户表达投票意见的正当性)，但是这部分产生的token可以用于治理相关的生态激励
交易所的地址，作为黑名单，可以享受NAT的token的空投，但是不能行使投票权利（因为没有代表用户表达投票意见的正当性），同时不享受投票行为部分的NAT激励




\subsection{NAT算法}
\textbf{空投部分}

我们分若干个投票周期。我们用$n$表示当前投票周期的序号。如前所述，每个投票周期（一般而言为一周）根据每个地址的NR值获取增发的NAT。若某地址的NR值为$x$，则第$n$周期增发的NAT为$\lambda f_n(x)$。关于$f_n(x)$的选取，现给出如下方案：

%其中$\lambda \leq 1$为衰减比例参数，随当前市场现存总NAT而变化（总NAT越多$\lambda$越小）。$f(\cdot)$为NR到NAT的映射函数，递增，且满足$f(0)=0$。

\begin{itemize}
	\item $f_n(x)=g(x)\lambda^n$, $\lambda<1$。其中$g(x)$为从NR到NAT数量的一个线性映射。该方案可以理解为，增发的NAT总量每轮缩减$(1-\lambda)*100\%$
	\item 增发总量根据当前现存NAT总量动态调整。如根据上面算法设定一个等比数列预期值，然后补上预期值与当前差值。
\end{itemize}

%因为NR总量不超过NAS总量，NAS总量根据增发规律少于$10^9(1+0.002n)$，故可得$x<10^9+0.002n$。据此可证方案123 NAT总量均有上限。（具体证明通过后给出）

\textbf{投票部分}

每个用户支付的用于投票的NAT立即销毁。

\textbf{返还部分}

一周期投票结束后，为了激励正常投票的用户，会根据用户此周期内所投票数返还一定比例的NAT。返还比例为$\mu>1$乘以投票数目。最高不超过$\mu C_{in}$。其中$C_{in}$为预期用户$i$在第$n$周期投出的NAT数目。一般而言选取$C_{in}=f_n(x_i)$，其中$x_i$为此用户该周期的NR，即，我们希望用户把此周期增发的NAT用于投票。用户一次投出过多的票相当于该用户要“动老本”进行投票。

注意:$C_{in}$一定要和增发数量挂钩，以防止滚雪球效应。	

\begin{comment}
具体数额为
$$\mu C \min \{\frac{C_0}{C},1\}$$
其中$\mu>1$为激励系数，可选取$\mu=1.1$。$C$为用户此阶段（一个增发周期内）投票花费（即烧毁的）NAT总数目，$C_0$为预期希望用户投出的NAT数目，每个用户对应不同的$C_0$，一般而言选取$C_0=\lambda f(x_1)$，即我们希望用户把此阶段增发的NAT用于投票，而不推荐用户一次投出过多的票。

对于用户而言，假设他一个阶段内用$C$枚NAT进行投票且$C \leq C_0$，则其NAT的变化量为
$$\mu C \min \{\frac{C_0}{C},1\}-C = \mu C_0-C$$
上式随$C$递减。这意味着对于一个利益最大化的用户而言他的最优策略为投出$C_0$票。如若项目对其意义重大，需要投出大量NAT，则有可能$\mu C_0-C <0$，相当于该用户要“动老本”进行投票。

若$C < C_0$，则其NAT的变化量为

$$\mu C \min \{\frac{C_0}{C},1\}-C = (\mu-1)C$$
上式随$C$递增，这意味着最优策略同样是投出$C_0$票。当投票数目较少时仍能获得收益但相对投$C_0$而言较少。

\end{comment}
[通过后，此处加变化曲线图]

注意：
\begin{itemize}
\item 目前版本暂定赞同票与反对票没有区别，即返还比例不同。之后可根据票种设定并乘上不同的返回参数$\mu_1$
\item 若考虑到投票完成后系统的总NR变化，则可再乘上一个系数$\mu_2$，用于反应该周期系统的繁荣度。
\item 若上述两条采用最终返回NAT数值为
$$ \mu\mu_1\mu_2 C \min \{\frac{C_0}{C},1\}$$
\end{itemize}


\begin{property}
本算法能满足NAT总量的收敛性，即NAT总量在任何时候都不会超过一个上限。
\end{property}
\begin{proof}
	根据星云链技术白皮书的设定\footnote{https://nebulas.io/docs/NebulasTechnicalWhitepaperZh.pdf}，NAS的固定总量为$10^9$，平均每周大约增发（在固定总量的基础上）$0.2\%$，故在第$n$个投票周期市面上现存NAS总量不会超过$10^9(1+0.002n)$。
	
	接下来我们证明所有地址一个周期内的资产中值（见星云指数黄皮书中的定义\footnote{https://nebulas.io/docs/NebulasYellowpaperZh.pdf}）总和不会超过市面上现存NAS总量。这是因为，对于任意一笔数量为$y$的NAS资产，他只能最多在一个地址内存在该周期一半以上的时间（三天半），故最多给全网节点的总资产中值提供$y$的贡献。
	
	同样根据星云指数黄皮书的设定，任何一个地址的NR值不会超过该地址的资产中值（指同样一个周期内，注意NR，NAT的计算都是以周为单位，具有同步性），这是因为黄皮书NR计算公式$\Omega(\cdot)\Psi(\cdot)$中，以资产中值为输入的Wilbur函数$\Omega(\cdot)$满足$\Omega(x)\leq x$，且出入度函数$\Psi(\cdot)$值域不超过1。
	
	结合上述结论，可得在第$n$个周期，所有地址NR总和不超过$10^9(1+0.002n)$，从而NAT增发数量不超过$g(10^9(1+0.002n))\lambda^n$
	
	又因为投票返还部分的NAT不超过增发部分乘以$\mu$，故即使加上返还部分带来的增量，周期$n$内NAT的总增量超过$\mu g(10^9(1+0.002n))\lambda^n$
	
	最后，欲证NAT总量的收敛性，只需证明级数
	$$\sum_{n=1}^{\infty} \mu g(10^9(1+0.002n))\lambda^n$$
	收敛，由于$g(\cdot)$为线性函数，故
	$$ \lim_{n\rightarrow \infty} \frac{\mu g(10^9(1+0.002(n+1)))\lambda^{n+1}}{\mu g(10^9(1+0.002n))\lambda^n} = \lambda <1$$
	由比试判别法可得该级数收敛，证毕。
\end{proof}
同时，上述投票算法具有下列良好性质。
\begin{enumerate}
	\item 抗滚雪球效应：如若简单的按固定比例返还NAT，则一个用户可以每次投出所有的NAT并享受大于1比例的返还（如1.1）,则其总NAT将按$1.1^n$指数级上升，增长过于庞大。
	\item 抗收买性：若一个低NR的用户以购买的方式获取大量NAT并用于投票，由于对低NR用户我们设定的对应$C_0$较低，返还的NAT很少，大部分都被烧毁，导致该用户剩余NAT很少作为惩罚。
	\item 抗通货膨胀：由于系统增发NAT比例与当前市场NAT总量有关，可有效控制NAT的贬值。
	\item 头部效应：早期拥有高NR的用户能拥有更高NAT总量
\end{enumerate}

\subsection{执行}
\textbf{提案人义务}
\begin{enumerate}
\item 监督执行人执行，各时间点没有错失。
\item 维护社区讨论。
\end{enumerate}

\textbf{提案人权利}
\begin{enumerate}
\item 享有提案中涉及的应得回报。
\item 在申请参与执行的社区用户中挑选合适的人来执行。
\end{enumerate}

\textbf{执行人义务}
\begin{enumerate}
\item 定期公示进度，保证执行过程公开透明。
\item 保证按时保质完成，并按照提案要求提交成果。
\end{enumerate}

\textbf{执行人权利}
\begin{enumerate}
\item 享有提案中涉及的应得回报。
\item 在不影响进度并且能达成最终目标的情况下，有权调整具体的执行步骤。
\end{enumerate}

\textbf{执行时长}

考虑到币价波动，建议不超过一季度。复杂度高的项目建议拆分阶段进行。

\textbf{提前终止}

如果开发没有按时完成，提案立即提前宣告失败。社区预留资金不会发放。

\subsection{公测}
\textbf{公测步骤}

完整的公测需要经过以下3个步骤：
\begin{enumerate}
\item 提交项目成果。开始公开测试。
\item 投票。二次投票方法和时长与一次投票相同，NAT占比y\%应大于等于x\%。
\item 技术委员会审核。通过二次投票的技术类提案，会随机派给三名技术委员会相关技术人员进行复审，全部通过即视为通过，进入发布流程。
\end{enumerate}

\textbf{测试时长}

技术类项目按照开发时长折算，最短时间为开发周期的10\%。

\subsection{发布}
非技术项目通过公测后即视为成功。技术项目需要进行链上数据更新。

\textbf{链上数据更新流程}

当协议需要升级之时，包含升级的代码会被包含在一个特殊的交易当中。这类交易只能由星云理事会暂时代为控制的主节点发起，并广播到全网。之后所有节点一旦接收到这类交易，NBRE将会自动执行其中包含的升级代码，完成更新。与此同时，核心协议的旧版本仍会在链上，以作参考。注意，节点拒绝更新只能重写本地代码。

\textbf{技术相对优势}
\begin{enumerate}
	\item 其他区块链项目升级主要还是通过硬/软分叉的方式，星云升级不需要进行分叉。
\item 交易所等不需要充停。
\item 高效率，零成本。
\end{enumerate}

举例：每个区块是火车上的一节车厢，那么每个区块中的交易就相当于车厢中的乘客。之前，如果火车发生故障，我们需要把它送到工厂维修，就像是我们手动修复漏洞，升级代码。当主网发现漏洞之后，这时，火车不能继续运行，车上的乘客也会因此受到影响。而NBRE的升级方式相当于把零部件提前放在火车上，用一节车厢专门储存零部件，当火车发生故障之时，车上的工人就可以及时换上新的部件。在此过程中，火车仍可正常运作。

\textbf{奖励发放}

发布主网后自动发放所有相关人员的奖励。

